
<!DOCTYPE html>

<html lang="en" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<title></title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!--[if mso]><xml><o:OfficeDocumentSettings><o:PixelsPerInch>96</o:PixelsPerInch><o:AllowPNG/></o:OfficeDocumentSettings></xml><![endif]-->
<!--[if !mso]><!-->
<link href="https://fonts.googleapis.com/css?family=Abril+Fatface" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet" type="text/css"/>
<!--<![endif]-->
<style>
    * {
      box-sizing: border-box;
    }

    .downloadbtn{
      text-decoration:none;display:inline-block;
      color:#3c8f7c;
      background-color:#d6f4a6;
      border-radius:3px;
      width:auto;
      border-top:1px solid #d6f4a6;
      border-right:1px solid #d6f4a6;
      border-bottom:1px solid #d6f4a6;
      border-left:1px solid #d6f4a6;
      padding-top:2px;
      padding-bottom:2px;
      text-align:center;
      mso-border-alt:none;word-break:keep-all;
    }

    th.column {
      padding: 0
    }

    a[x-apple-data-detectors] {
      color: inherit !important;
      text-decoration: inherit !important;
    }

    #MessageViewBody a {
      color: inherit;
      text-decoration: none;
    }

    p {
      line-height: inherit
    }

    @media (max-width:700px) {
      .icons-inner {
        text-align: center;
      }

      .icons-inner td {
        margin: 0 auto;
      }

      .row-content {
        width: 100% !important;
      }

      .stack .column {
        width: 100%;
        display: block;
      }

      .reverse {
        display: table;
        width: 100%;
      }

      .reverse th.first {
        display: table-footer-group !important;
      }

      .reverse th.last {
        display: table-header-group !important;
      }

      .row-21 th.column.first>table,
      .row-21 th.column.last>table,
      .row-7 th.column.first>table,
      .row-7 th.column.last>table {
        padding-left: 0;
        padding-right: 0;
      }
    }
  </style>
</head>
<body class="msg-examples" style="background-color: #052d2c; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;">

  
<table border="0" cellpadding="0" cellspacing="0" class="nl-container" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #052d2c;" width="100%">
<tbody>
<tr>
<td>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row row-1" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tbody>
<tr>
<td>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row-content stack" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="680">
<tbody>
<tr>
<th class="column" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; vertical-align: top; padding-top: 0px; padding-bottom: 0px;" width="100%">
<div class="spacer_block" style="height:20px;line-height:20px;"> </div>
</th>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row row-2" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tbody>
<tr>
<td>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row-content stack" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-image: url('images/Hero-backg.png'); background-repeat: no-repeat;" width="680">
<tbody>
<tr>
<th class="column" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; vertical-align: top; padding-top: 5px; padding-bottom: 5px;" width="100%">
<table border="0" cellpadding="0" cellspacing="0" class="image_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tr>
<td style="padding-left:20px;padding-top:65px;width:100%;padding-right:0px;">
<div align="center" style="line-height:10px"><img alt="Yourlogo" src="http://assets.supersalud.gov.co/SiteCollectionImages/logo-supersalud.png" style="display: block; height: auto; border: 0; width: 800; max-width: 100%;" title="Yourlogo" width="800"/></div>
</td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" class="text_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;" width="100%">
<tr>
<td style="padding-left:20px;padding-right:20px;padding-top:40px;">
<div style="font-family: sans-serif">
<div style="font-size: 14px; color: #ffffff; line-height: 1.2; font-family: Nunito, Arial, Helvetica Neue, Helvetica, sans-serif;">
<p style="margin: 0; font-size: 14px; text-align: center;"><strong><span style="font-size:20px;" class="msg-subject"></span></strong></p>
<p style="margin: 0; font-size: 14px; text-align: center; mso-line-height-alt: 24px;">De <span style="font-size:11px;" class="msg-from"></span></p>
<p style="margin: 0; font-size: 14px; text-align: center; mso-line-height-alt: 24px;">Para <span style="font-size:11px;" class="msg-to"></span></p>
</div>
</div>
</td>
</tr>
</table>



</th>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row row-3" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tbody>
<tr>
<td>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row-content stack" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #084644;" width="680">
<tbody>
<tr>
<th class="column" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; vertical-align: top; padding-top: 0px; padding-bottom: 0px;" width="100%">
<div class="spacer_block" style="height:80px;line-height:80px;"> </div>
</th>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row row-4" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tbody>
<tr>
<td>
<table align="center" border="0" cellpadding="0" cellspacing="0" class="row-content stack" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #084644;" width="680">
<tbody>
<tr>
<th class="column" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; vertical-align: top; padding-top: 0px; padding-bottom: 0px;" width="100%">
<table border="0" cellpadding="0" cellspacing="0" class="divider_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="100%">
<tr>
<td style="padding-left:30px;padding-right:30px;">
<div align="center">
<table border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;" width="10%">
<tr>
<td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 3px solid #D6F4A6;"><span></span></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" class="text_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;" width="100%">
<tr>
<td style="padding-bottom:15px;padding-left:20px;padding-right:20px;padding-top:10px;">
<div style="font-family: sans-serif">
<div style="font-size: 14px; color: #d6f4a6; line-height: 1.2; font-family: Nunito, Arial, Helvetica Neue, Helvetica, sans-serif;">
<p style="margin: 0; font-size: 20px; text-align: center;"><strong>Contenido</strong></p>
</div>
</div>
</td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" class="text_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;" width="100%">
<tr>
<td style="padding-bottom:40px;padding-left:20px;padding-right:20px;padding-top:10px;">
<div style="font-family: sans-serif">
<div style="font-size: 14px; color: #ffffff; line-height: 1.5; font-family: Nunito, Arial, Helvetica Neue, Helvetica, sans-serif;">
<p style="margin: 0; font-size: 14px; text-align: center; mso-line-height-alt: 24px;"><span style="font-size:16px;" class="msg-body"></span></p>

</div>
</div>
</td>
</tr>
<table border="0" cellpadding="0" cellspacing="0" class="text_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;" width="100%">
<tr>
<td style="padding-bottom:15px;padding-left:20px;padding-right:20px;padding-top:10px;">
<div style="font-family: sans-serif">
<div style="font-size: 14px; color: #d6f4a6; line-height: 1.2; font-family: Nunito, Arial, Helvetica Neue, Helvetica, sans-serif;">
<p style="margin: 0; font-size: 20px; text-align: center;"><strong>Adjuntos</strong></p>
</div>
</div>
</td>
</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" class="text_block" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;" width="100%">
<tr>
<td style="padding-bottom:40px;padding-left:20px;padding-right:20px;padding-top:10px;">
<div style="font-family: sans-serif">
<div style="font-size: 14px; color: #ffffff; line-height: 1.5; font-family: Nunito, Arial, Helvetica Neue, Helvetica, sans-serif;">
<p style="margin: 0; font-size: 14px; text-align: center; mso-line-height-alt: 24px;"><span style="font-size:12px;" class="msg-attachment"></span></p>

</div>
</div>
</td>
</tr>
</table>
<div class="container"> 
    <div class="row">
      <a href="<?=$url?>"  class="downloadbtn" style="color:black">Descargar msg original <img src="http://simpleicon.com/wp-content/uploads/cloud-download-1.png" style="width:12px"></a>
   </div>
</div>
</body>
</html>





<div class="incorrect-type info-box error-msg" style="display: none;">
  No se encontro el archivo indicado
</div>

<div class="file-api-not-available info-box error-msg" style="display: none;">
 El navegador no es soportado
</div>
<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="<?=$bodegaurl?>visormsg/DataStream.js"></script>
<script src="<?=$bodegaurl?>visormsg/msg.reader.js"></script>
<script>
  function isSupportedFileAPI() {
    return window.File && window.FileReader && window.FileList && window.Blob;
  }

  function formatEmail(data) {
    return data.name ? data.name + " [" + data.email + "]" : data.email;
  }

  function parseHeaders(headers) {
    var parsedHeaders = {};
    if (!headers) {
      return parsedHeaders;
    }
    var headerRegEx = /(.*)\: (.*)/g;
    while (m = headerRegEx.exec(headers)) {
      // todo: Pay attention! Header can be presented many times (e.g. Received). Handle it, if needed!
      parsedHeaders[m[1]] = m[2];
    }
    return parsedHeaders;
  }

  function getMsgDate(rawHeaders) {
    // Example for the Date header
    var headers = parseHeaders(rawHeaders);
    if (!headers['Date']){
      return '-';
    }
    return new Date(headers['Date']);
  }

  $(function () {
    if (isSupportedFileAPI()) {
        var oReq = new XMLHttpRequest();
        oReq.open("GET", "<?=$url?>", true);
        oReq.responseType = "blob";
        oReq.onreadystatechange = function(){
                var blob = this.response;
                blob.name = "myMessage.msg";

                //JS code from example.html with line 116 changed to
                 var selectedFile = blob;
                 console.log(selectedFile);
                  if (!selectedFile) {
                    $('.msg-info, .incorrect-type').hide();
                    return;
                  }
                  if (selectedFile.name.indexOf('.msg') == -1) {
                    $('.msg-info').hide();
                    $('.incorrect-type').show();
                    return;
                  }
                  $('.msg-example .msg-file-name').html(selectedFile.name);
                  $('.incorrect-type').hide();

                  // read file...
                  var fileReader = new FileReader();
                  fileReader.onload = function (evt) {

                    var buffer = evt.target.result;
                    var msgReader = new MSGReader(buffer);
                    var fileData = msgReader.getFileData();
                    if (!fileData.error) {
                      $('.msg-from').html(formatEmail({name: fileData.senderName, email: fileData.senderEmail}));

                      $('.msg-to').html(jQuery.map(fileData.recipients, function (recipient, i) {
                        return formatEmail(recipient);
                      }).join('<br/>'));
                      $('.msg-date').html(getMsgDate(fileData.headers));
                      $('.msg-subject').html(fileData.subject);
                      $('.msg-body').html(
                          fileData.body ? fileData.body.substring(0, Math.min(500, fileData.body.length))
                          + (fileData.body.length > 500 ? '...' : '') : '');
                      if (fileData.bodyHTML) {
                        $('.msg-body-html').html(fileData.bodyHTML).closest('div.field-block').show();
                      } else {
                        $('.msg-body-html').closest('div.field-block').hide();
                      }
                      $('.msg-attachment').html(jQuery.map(fileData.attachments, function (attachment, i) {
                        var file = msgReader.getAttachment(i);
                        var fileUrl = URL.createObjectURL(new File([file.content], attachment.fileName,
                          {type: attachment.mimeType ? attachment.mimeType : "application/octet-stream"}));
                        return attachment.fileName + '  <a target="_blank" class=downloadbtn href="' + fileUrl + '"> Descargar <img src=http://simpleicon.com/wp-content/uploads/cloud-download-1.png style="width:12px">  </a>';
                      }).join('<br/>'));
                      $('.msg-info').show();

                      // Use msgReader.getAttachment to access attachment content ...
                      // msgReader.getAttachment(0) or msgReader.getAttachment(fileData.attachments[0])
                    } else {
                      $('.msg-info').hide();
                      $('.incorrect-type').show();
                    }
                  };
                  fileReader.readAsArrayBuffer(selectedFile);

        }   
        oReq.send();   
                 
    } else {
      $('.msg-example').hide();
      $('.file-api-not-available').show();
    }
  });
</script>
</body>
</html>
